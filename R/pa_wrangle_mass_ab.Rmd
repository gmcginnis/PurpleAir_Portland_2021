---
title: "pa_wrangle_mass_ab"
author: "Gillian McGinnis"
date: "1/13/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) #dplyr, etc
library(lubridate) #better time/date manipulation
```

```{r}
#my_file_paths <- list.files(path="data/raw", pattern="SE",full.names=TRUE) #smaller subset
all_paths <- list.files(path="data/raw", pattern="Real Time",full.names=TRUE)

my_files <- all_paths %>%
  as.data.frame() %>%
  rename(source = ".") %>%
  mutate(source = str_replace(source, ".\\w+\\/\\w+\\/", "")) %>% #removes filepath name
  mutate(loc_tag = str_extract(source, "^[^\\(]+"),
         #loc_tag_new = str_replace(loc_tag, " B ", ""),
         #inoutun = str_extract(source, "(outside|inside|undefined)"),
         inout = str_extract(source, "(outside|inside)"),
         ab = str_extract(source, " B \\("),
         primsec = str_extract(source, "\\) (Primary|Secondary)")) %>%
  mutate(loc_tag = str_replace(loc_tag, " B ", ""),
         loc_tag = str_trim(loc_tag, side="right"),
         primsec = str_extract(primsec, "(Primary|Secondary)"),
         ab = str_extract(ab, "B"),
         ab = replace_na(ab, "A")) %>%
  group_by(loc_tag) %>%
  #select(loc_tag_new, inout, ab) %>%
  fill(inout) %>%
  filter(inout == "outside",
         primsec == "Primary") %>%
  select(!c(inout, primsec))
```

```{r}
my_file_paths <- list.files(path = "data/raw", pattern = "SE", full.names = TRUE)
#my_file_paths <- list.files(path = "data/raw", pattern = "Primary Real Time", full.names=TRUE)

raw_data <- my_file_paths %>%
  set_names() %>%
  map_dfr(~read_csv(.x, col_types = cols(source = col_character(),
                                         created_at = col_character(),
                                         .default = col_double())), .id="source") %>%
  mutate(source = str_replace(source, ".\\w+\\/\\w+\\/", "")) #removes filepath name

#dat_csv = ldply(my_file_paths, read_csv)
raw_data_2 <- my_file_paths %>%
  #lapply(read_csv, col_types = cols(.default = "c"))
  map_df(~read_csv(.x, col_types = cols(.default = "c")))
  #map_df(~read_csv(.x))

raw_data <- my_file_paths %>%
  set_names()%>%
  map_df(~read_csv(.x, col_types = cols(#source = col_character(),
                                        created_at = col_character(),
                                        X11 = col_character(),
                                        .default = "d")), .id="source")

processed_data <- raw_data %>%
  select(!c("entry_id", "UptimeMinutes", "X11")) %>%
  select(source, created_at, `PM2.5_CF1_ug/m3`) %>%
  drop_na(`PM2.5_CF1_ug/m3`) %>%
  mutate(source = str_replace(source, ".\\w+\\/\\w+\\/", "")) %>% #removes filepath name
  #mutate_at(vars(-created_at), as.double)
  # mutate(`PM1.0_CF1_ug/m3` = as.double(`PM1.0_CF1_ug/m3`),
  #        `PM2.5_CF1_ug/m3` = as.double(`PM2.5_CF1_ug/m3`),
  #        )
  mutate()

#lapply(my_file_paths, read_csv)
```



