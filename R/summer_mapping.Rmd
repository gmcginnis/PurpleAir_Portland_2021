---
title: "summer_mapping"
author: "Gillian McGinnis"
date: "6/21/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

input_path_filter <- "*PSU*"
source(knitr::purl("R/summer_wrangle.Rmd"))
file.remove("summer_wrangle.R")
remove(data_secondary, file_list, clean_data, list = ls(pattern = "input_"))

source(knitr::purl("R/summer_epa.Rmd"))
file.remove("summer_epa.R")

library(ggmap)
library(lubridate)
```


```{r function_grab_map}
grab_map <- function(bottom, top, left, right, maptype = "toner-lite", zoom = 11, crop = TRUE){
  coord_box <- c(bottom = bottom, top = top, left = left, right = right)
  data_map <- get_stamenmap(coord_box, maptype = maptype, zoom = zoom, crop = crop)
}

pdx_map <- grab_map(45.5, 45.6, -122.854, -122.58, "toner-lite") %>% ggmap()
```

```{r}
grab_map_auto <- function(location_df, maptype = "toner-lite", zoom = 11, crop = TRUE){
  location_df %>% 
    ungroup() %>% 
    summarize(
      left = min(lon),
      bottom = min(lat),
      right = max(lon),
      top = max(lat)
    ) %>% 
    as.numeric() %>% 
    get_stamenmap(maptype = maptype, zoom = zoom, crop = crop)
}

grab_map_auto(data_loc)
```


```{r}
input_date_starts <- as.Date(c("2020-09-01", "2020-09-10", "2020-09-20"))
input_date_ends <- as.Date(c("2020-09-09", "2020-09-19", "2020-09-29"))
input_date_tags <- factor(c("pre", "fire", "post"))

data_dates <- data.frame(
  input_date_starts, input_date_ends, input_date_tags
) %>% 
  arrange(input_date_starts) %>% 
  mutate(date_tag = fct_inorder(input_date_tags)) %>% 
  pivot_longer(cols = c(input_date_starts, input_date_ends), values_to = "date") %>% 
  group_by(date_tag) %>% 
  complete(date = full_seq(date, 1)) %>%
  select(!c(name, input_date_tags))

data_dated <- data_corr %>% 
  left_join(data_dates) %>% 
  drop_na(date_tag)

remove(data_dates, list = ls(pattern = "input_"))
```

```{r}
data_mapping <- data_dated %>% 
  group_by(loc_tag, date_tag) %>% 
  summarize(epa_2021 = mean(epa_2021, na.rm = TRUE)) %>% 
  left_join(data_loc)

pdx %>% 
  ggmap() +
  facet_wrap(~date_tag) +
  geom_point(data = data_mapping, aes(size = epa_2021, color = epa_2021, shape = loc_inout))
```


